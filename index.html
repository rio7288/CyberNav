<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberNav: Connected Learning Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03); }
        .roadmap-node { transition: all 0.3s ease; }
        .roadmap-node:hover { transform: translateY(-2px); }
        
        /* Custom Checkbox */
        .cyber-checkbox { appearance: none; width: 1.25rem; height: 1.25rem; border: 2px solid #cbd5e1; border-radius: 0.25rem; background: white; cursor: pointer; position: relative; }
        .cyber-checkbox:checked { background-color: #3b82f6; border-color: #3b82f6; }
        .cyber-checkbox:checked::after { content: '‚úì'; position: absolute; color: white; font-size: 0.8rem; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        
        .fade-in { animation: fadeIn 0.4s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .view-section { display: none; }
        .view-section.active { display: block; }
        .chart-container { position: relative; width: 100%; height: 300px; }
        
        .res-link { transition: all 0.2s; }
        .res-link:hover { background-color: #334155; transform: translateX(4px); }

        /* Custom Scrollbar */
        .panel-scroll::-webkit-scrollbar { width: 6px; }
        .panel-scroll::-webkit-scrollbar-track { background: #1e293b; border-radius: 4px; }
        .panel-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        .panel-scroll::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 flex flex-col min-h-screen">

    <!-- Header -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-6">
                    <div class="flex-shrink-0 flex items-center gap-2 cursor-pointer" onclick="switchView('roadmap')">
                        <span class="text-2xl font-bold text-blue-900 tracking-tight">Cyber<span class="text-blue-600">Nav</span></span>
                    </div>
                    <div class="hidden md:flex space-x-1 bg-slate-100 p-1 rounded-lg">
                        <button onclick="switchView('roadmap')" class="px-3 py-1.5 text-sm font-medium rounded-md transition-all bg-white shadow text-blue-700" id="nav-roadmap">Roadmap</button>
                        <button onclick="switchView('dashboard')" class="px-3 py-1.5 text-sm font-medium rounded-md transition-all text-slate-600 hover:text-slate-900" id="nav-dashboard">Dashboard</button>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="hidden md:flex bg-slate-100 rounded-lg p-1 space-x-1" id="role-selector">
                        <button onclick="updateRole('general')" class="px-3 py-1.5 rounded-md text-xs font-medium transition-colors bg-white shadow text-slate-900" id="btn-general">General</button>
                        <button onclick="updateRole('red')" class="px-3 py-1.5 rounded-md text-xs font-medium text-slate-600" id="btn-red">Red Team</button>
                        <button onclick="updateRole('blue')" class="px-3 py-1.5 rounded-md text-xs font-medium text-slate-600" id="btn-blue">Blue Team</button>
                        <button onclick="updateRole('grc')" class="px-3 py-1.5 rounded-md text-xs font-medium text-slate-600" id="btn-grc">GRC</button>
                    </div>
                    <div class="border-l border-slate-200 pl-4 flex items-center gap-3">
                        <span id="user-display" class="hidden text-xs font-bold text-slate-500 bg-slate-100 px-2 py-1 rounded">Guest</span>
                        <button id="btn-login" class="bg-slate-900 hover:bg-slate-800 text-white text-xs font-bold py-2 px-4 rounded transition-colors shadow-md">Login with Google</button>
                        <button id="btn-logout" class="hidden text-xs text-red-500 font-bold hover:text-red-700">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">

        <!-- VIEW: ROADMAP -->
        <div id="view-roadmap" class="view-section active space-y-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="col-span-2">
                    <h1 class="text-3xl font-extrabold text-slate-900" id="hero-title">General Cybersecurity</h1>
                    <p class="text-slate-600 mt-2 text-sm leading-relaxed" id="hero-desc">Loading content...</p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-xl border border-slate-200 text-center shadow-sm">
                        <p class="text-xs text-slate-400 uppercase font-bold">Avg. Salary</p>
                        <p class="text-lg font-bold text-slate-800" id="stat-salary">...</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl border border-slate-200 text-center shadow-sm">
                        <p class="text-xs text-slate-400 uppercase font-bold">Timeline</p>
                        <p class="text-lg font-bold text-slate-800" id="stat-time">...</p>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
                
                <!-- Left: Roadmap Timeline (Scrollable) -->
                <div class="lg:col-span-7 space-y-6">
                    <div class="bg-white p-6 rounded-xl border border-slate-200 card-shadow">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-bold text-slate-800">Learning Path</h2>
                            <div class="flex items-center gap-2">
                                <span class="text-xs text-slate-500">Progress:</span>
                                <div class="w-24 bg-slate-100 h-2 rounded-full overflow-hidden">
                                    <div id="mini-progress-bar" class="bg-green-500 h-full w-0 transition-all duration-500"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="relative py-2 pl-4">
                            <div class="absolute left-10 top-0 bottom-0 w-0.5 bg-slate-200"></div>
                            <div id="roadmap-items" class="space-y-8">
                                <!-- JS Injects Here -->
                            </div>
                        </div>
                    </div>

                     <!-- Tools Section -->
                     <div class="bg-white p-6 rounded-xl border border-slate-200 card-shadow">
                        <h2 class="text-lg font-bold text-slate-800 mb-4">Essential Toolset</h2>
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-3" id="tools-grid">
                            <!-- JS Injects Here -->
                        </div>
                    </div>
                </div>

                <!-- Right: Details (STICKY) -->
                <div class="lg:col-span-5 space-y-6 lg:sticky lg:top-24">
                    
                    <!-- Detail Panel (Fixed Height & Scrollable) -->
                    <div class="bg-slate-900 text-white p-6 rounded-xl shadow-lg border-t-4 border-blue-500 flex flex-col max-h-[85vh]">
                        <div class="flex-shrink-0 flex justify-between items-start mb-4">
                            <h3 class="text-lg font-bold text-white" id="detail-title">Select a Module</h3>
                            <span class="text-xs bg-slate-700 px-2 py-1 rounded text-slate-300 border border-slate-600" id="detail-phase">Info</span>
                        </div>
                        
                        <!-- Scrollable Content Area -->
                        <div class="overflow-y-auto panel-scroll pr-2 space-y-5">
                            <p class="text-slate-300 text-sm leading-relaxed" id="detail-desc">
                                Click any node on the left timeline to reveal curated videos, labs, and documentation.
                            </p>
                            
                            <div id="detail-content" class="hidden space-y-5">
                                <!-- Key Topics -->
                                <div>
                                    <h4 class="text-xs font-bold text-blue-400 uppercase tracking-wider mb-2">Key Concepts</h4>
                                    <ul class="text-sm text-slate-300 space-y-1 list-disc pl-4" id="detail-topics"></ul>
                                </div>

                                <!-- Resources Container -->
                                <div class="bg-slate-800/50 rounded-lg p-4 border border-slate-700">
                                    <h4 class="text-xs font-bold text-green-400 uppercase tracking-wider mb-3 flex items-center gap-2">
                                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                                        Curated Resources
                                    </h4>
                                    <div id="detail-resources" class="space-y-2">
                                        <!-- Resource links injected here -->
                                    </div>
                                </div>

                                <div class="bg-slate-800/50 p-3 rounded border border-slate-700">
                                    <h4 class="text-xs font-bold text-yellow-400 uppercase tracking-wider mb-1">Practical Task</h4>
                                    <p class="text-sm text-slate-200 italic" id="detail-focus"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cert Ladder -->
                    <div class="bg-white p-6 rounded-xl border border-slate-200 card-shadow">
                        <h3 class="text-lg font-bold text-slate-800 mb-4">Certification Roadmap</h3>
                        <div class="space-y-4" id="cert-ladder">
                            <!-- JS Injects Here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: DASHBOARD -->
        <div id="view-dashboard" class="view-section space-y-8">
            <h2 class="text-3xl font-bold text-slate-900 mb-6">Progress Analytics</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl border border-slate-200 card-shadow">
                    <p class="text-sm text-slate-500 font-bold uppercase">Modules</p>
                    <p class="text-4xl font-bold text-slate-800 mt-2" id="dash-count">0/0</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-slate-200 card-shadow">
                    <p class="text-sm text-slate-500 font-bold uppercase">XP Earned</p>
                    <p class="text-4xl font-bold text-blue-600 mt-2" id="dash-xp">0</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-slate-200 card-shadow">
                    <p class="text-sm text-slate-500 font-bold uppercase">Phase</p>
                    <p class="text-2xl font-bold text-emerald-600 mt-2" id="dash-phase">Start</p>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-xl border border-slate-200 card-shadow">
                    <div class="chart-container"><canvas id="gapRadarChart"></canvas></div>
                </div>
                <div class="bg-white p-6 rounded-xl border border-slate-200 card-shadow">
                    <div class="chart-container"><canvas id="phaseBarChart"></canvas></div>
                </div>
            </div>
        </div>
    </main>

    <!-- 1. DATA AND UI LOGIC -->
    <script>
        // --- DATA DEFS ---
        const roles = {
            general: { 
                title: "General Cybersecurity", salary: "$75k - $95k", time: "6 - 12 Months",
                desc: "A solid foundation in all aspects of security, suitable for beginners or IT professionals pivoting to security.",
                pathIds: [1, 2, 3, 4, 5, 6], skills: [80, 80, 60, 50, 60],
                certs: [{ tier: "Entry", names: ["CompTIA Security+", "Network+"] }, { tier: "Mid", names: ["CySA+", "SSCP"] }, { tier: "Pro", names: ["CISSP", "CISM"] }]
            },
            red: { 
                title: "Red Team (Offensive)", salary: "$90k - $130k", time: "12 - 18 Months",
                desc: "Focus on ethical hacking, penetration testing, and exploit development.",
                pathIds: [1, 2, 3, 7, 8, 9], skills: [70, 90, 90, 95, 30],
                certs: [{ tier: "Entry", names: ["eJPT", "PNPT"] }, { tier: "Mid", names: ["OSCP", "CRTO"] }, { tier: "Pro", names: ["OSEP", "GXPN"] }]
            },
            blue: { 
                title: "Blue Team (Defensive)", salary: "$85k - $120k", time: "8 - 14 Months",
                desc: "Focus on detection, incident response, threat hunting, and SOC operations.",
                pathIds: [1, 2, 3, 10, 11, 12], skills: [95, 85, 60, 80, 70],
                certs: [{ tier: "Entry", names: ["BTL1", "CySA+"] }, { tier: "Mid", names: ["GCIH", "CCNA CyberOps"] }, { tier: "Pro", names: ["GCFA", "GREM"] }]
            },
            grc: { 
                title: "GRC (Governance)", salary: "$100k - $140k", time: "6 - 10 Months",
                desc: "Focus on policy, auditing, risk assessment, and legal frameworks.",
                pathIds: [1, 13, 14, 15], skills: [40, 40, 20, 30, 100],
                certs: [{ tier: "Entry", names: ["CGRC", "CAP"] }, { tier: "Mid", names: ["CISA", "CRISC"] }, { tier: "Pro", names: ["CGEIT", "CISSP"] }]
            }
        };

        const roadmapData = [
            { 
                id: 1, phase: "Foundations", title: "IT Networking & OS", desc: "Learn TCP/IP, OSI Model, Linux CLI, and Windows Registry.", topics: ["OSI Model", "Subnetting", "Linux CLI"], focus: "Install Ubuntu VM.", points: [30, 30, 0, 10, 0], 
                resources: [
                    {type:'yt',title:'NetworkChuck: CCNA Course',url:'https://www.youtube.com/playlist?list=PLIhvC56v63IJVXv0GGkCMxHFUZkcXPMKC'},
                    {type:'yt',title:'PowerCert: Networking Animated',url:'https://www.youtube.com/watch?v=4_zSIXb7tLQ'},
                    {type:'web',title:'Professor Messer Network+',url:'https://www.professormesser.com/network-plus/n10-008/n10-008-training-course/'},
                    {type:'doc',title:'Cisco Packet Tracer',url:'https://www.netacad.com/courses/packet-tracer'}
                ] 
            },
            { 
                id: 2, phase: "Foundations", title: "Coding & Scripting", desc: "Python for automation, Bash scripting, and basic HTML.", topics: ["Python Basics", "Bash", "PowerShell"], focus: "Write a ping sweeper script.", points: [0, 10, 40, 0, 0], 
                resources: [
                    {type:'web',title:'Automate the Boring Stuff (Book)',url:'https://automatetheboringstuff.com/'},
                    {type:'yt',title:'FreeCodeCamp: Python for Sec',url:'https://www.youtube.com/watch?v=F1W9dYJk2Gg'},
                    {type:'lab',title:'OverTheWire: Bandit (Linux)',url:'https://overthewire.org/wargames/bandit/'},
                    {type:'web',title:'Codecademy: Learn Python 3',url:'https://www.codecademy.com/learn/learn-python-3'}
                ] 
            },
            { 
                id: 3, phase: "Foundations", title: "Security Fundamentals", desc: "CIA Triad, Encryption, Access Control (RBAC/DAC).", topics: ["CIA Triad", "Encryption", "Access Control"], focus: "Study Security+.", points: [10, 0, 0, 10, 30], 
                resources: [
                    {type:'yt',title:'Professor Messer Sec+',url:'https://www.professormesser.com/security-plus/sy0-601/sy0-601-video-training-course/'},
                    {type:'web',title:'Cybrary: IT Fundamentals',url:'https://www.cybrary.it/course/comptia-it-fundamentals-fc0-u61/'},
                    {type:'doc',title:'NIST Glossary of Terms',url:'https://csrc.nist.gov/glossary'},
                    {type:'lab',title:'TryHackMe: Pre-Security',url:'https://tryhackme.com/path/outline/presecurity'}
                ] 
            },
            { 
                id: 4, phase: "Core Skills", title: "Vuln Management", desc: "Scanning and patching using Nessus or OpenVAS.", topics: ["CVSS", "Nessus", "Patching"], focus: "Scan home network.", points: [20, 10, 0, 20, 10], 
                resources: [
                    {type:'web',title:'Tenable Nessus Essentials',url:'https://www.tenable.com/products/nessus/nessus-essentials'},
                    {type:'doc',title:'CVSS Scoring Calculator',url:'https://www.first.org/cvss/calculator/3.1'},
                    {type:'web',title:'NIST NVD Database',url:'https://nvd.nist.gov/'},
                    {type:'doc',title:'Greenbone OpenVAS Docs',url:'https://greenbone.github.io/docs/'}
                ] 
            },
            { 
                id: 5, phase: "Core Skills", title: "Cloud Security", desc: "AWS/Azure IAM, S3 Security, and Shared Responsibility.", topics: ["IAM", "S3 Buckets", "Cloud Trails"], focus: "Secure AWS Account.", points: [20, 20, 10, 10, 10], 
                resources: [
                    {type:'web',title:'AWS Security Fundamentals',url:'https://explore.skillbuilder.aws/learn/course/external/view/elearning/13266/aws-security-fundamentals-second-edition'},
                    {type:'doc',title:'Microsoft Learn: Azure Security',url:'https://learn.microsoft.com/en-us/azure/security/'},
                    {type:'web',title:'Cloud.HackTricks.xyz',url:'https://cloud.hacktricks.xyz/'},
                    {type:'lab',title:'Google Cloud Skills Boost',url:'https://www.cloudskillsboost.google/'}
                ] 
            },
            { 
                id: 6, phase: "Career", title: "Professional Dev", desc: "Soft skills, report writing, and ethics.", topics: ["Reporting", "Ethics", "Networking"], focus: "Join OWASP.", points: [0, 0, 0, 0, 50], 
                resources: [
                    {type:'web',title:'OWASP Foundation',url:'https://owasp.org/'},
                    {type:'web',title:'CyberSeek: Career Maps',url:'https://www.cyberseek.org/pathway.html'},
                    {type:'blog',title:'Krebs on Security',url:'https://krebsonsecurity.com/'},
                    {type:'yt',title:'Darknet Diaries Podcast',url:'https://darknetdiaries.com/'}
                ] 
            },
            { 
                id: 7, phase: "Offensive", title: "Web Hacking", desc: "OWASP Top 10, SQL Injection, XSS, Burp Suite.", topics: ["SQLi", "XSS", "Burp Suite"], focus: "PortSwigger Labs.", points: [10, 0, 20, 40, 0], 
                resources: [
                    {type:'lab',title:'PortSwigger Academy (Free)',url:'https://portswigger.net/web-security'},
                    {type:'web',title:'OWASP Juice Shop',url:'https://owasp.org/www-project-juice-shop/'},
                    {type:'yt',title:'Rana Khalil: Web Pentesting',url:'https://www.youtube.com/c/RanaKhalil101'},
                    {type:'doc',title:'HackerOne: Activity',url:'https://hackerone.com/hacktivity'}
                ] 
            },
            { 
                id: 8, phase: "Offensive", title: "Net Pentesting", desc: "Nmap, Metasploit, AD Attacks.", topics: ["Nmap", "Metasploit", "Active Directory"], focus: "Hack The Box.", points: [40, 20, 10, 30, 0], 
                resources: [
                    {type:'lab',title:'Hack The Box (HTB)',url:'https://www.hackthebox.com/'},
                    {type:'yt',title:'TCM Security: Ethical Hacking',url:'https://www.youtube.com/c/TheCyberMentor'},
                    {type:'doc',title:'Metasploit Unleashed (Free)',url:'https://www.offsec.com/metasploit-unleashed/'},
                    {type:'lab',title:'Antisyphon Training',url:'https://www.antisyphontraining.com/pay-what-you-can/'}
                ] 
            },
            { 
                id: 9, phase: "Offensive", title: "Advanced Evasion", desc: "Bypassing AV/EDR, Obfuscation.", topics: ["Obfuscation", "C2", "LOLBins"], focus: "Bypass Defender.", points: [10, 30, 30, 20, 0], 
                resources: [
                    {type:'web',title:'LOLBAS Project',url:'https://lolbas-project.github.io/'},
                    {type:'blog',title:'SpecterOps Blog',url:'https://posts.specterops.io/'},
                    {type:'web',title:'The C2 Matrix',url:'https://www.thec2matrix.com/'},
                    {type:'doc',title:'Atomic Red Team',url:'https://github.com/redcanaryco/atomic-red-team'}
                ] 
            },
            { 
                id: 10, phase: "Defensive", title: "SOC Operations", desc: "SIEM (Splunk), Log Analysis, Phishing.", topics: ["Splunk", "Logs", "Phishing"], focus: "LetsDefend.io.", points: [30, 20, 0, 30, 0], 
                resources: [
                    {type:'lab',title:'LetsDefend (Blue Team)',url:'https://letsdefend.io/'},
                    {type:'web',title:'Splunk Fundamentals',url:'https://www.splunk.com/en_us/training/free-courses/splunk-fundamentals-1.html'},
                    {type:'yt',title:'Black Hills InfoSec',url:'https://www.youtube.com/user/BlackHillsInfoSec'},
                    {type:'lab',title:'CyberDefenders',url:'https://cyberdefenders.org/'}
                ] 
            },
            { 
                id: 11, phase: "Defensive", title: "Forensics", desc: "Memory/Disk Forensics, Malware Analysis.", topics: ["Wireshark", "Volatility", "Malware"], focus: "Analyze PCAP.", points: [20, 40, 0, 20, 10], 
                resources: [
                    {type:'web',title:'Malware Traffic Analysis',url:'https://www.malware-traffic-analysis.net/'},
                    {type:'yt',title:'13Cubed (Forensics)',url:'https://www.youtube.com/c/13cubed'},
                    {type:'doc',title:'Eric Zimmerman Tools',url:'https://ericzimmerman.github.io/#!index.md'},
                    {type:'lab',title:'MemLabs (GitHub)',url:'https://github.com/stuxnet999/MemLabs'}
                ] 
            },
            { 
                id: 12, phase: "Defensive", title: "Threat Hunting", desc: "YARA Rules, Threat Intel, IOCs.", topics: ["YARA", "MITRE ATT&CK", "IOCs"], focus: "Write YARA rule.", points: [20, 20, 10, 10, 0], 
                resources: [
                    {type:'web',title:'MITRE ATT&CK Framework',url:'https://attack.mitre.org/'},
                    {type:'doc',title:'YARA Documentation',url:'https://yara.readthedocs.io/en/stable/'},
                    {type:'blog',title:'The DFIR Report',url:'https://thedfirreport.com/'},
                    {type:'yt',title:'Active Countermeasures',url:'https://www.youtube.com/c/ActiveCountermeasures'}
                ] 
            },
            { 
                id: 13, phase: "Governance", title: "Frameworks", desc: "NIST CSF, ISO 27001, GDPR.", topics: ["NIST CSF", "ISO 27001", "GDPR"], focus: "Read NIST Summary.", points: [0, 0, 0, 0, 60], 
                resources: [
                    {type:'doc',title:'NIST CSF Full Text',url:'https://www.nist.gov/cyberframework'},
                    {type:'web',title:'GDPR.eu',url:'https://gdpr.eu/'},
                    {type:'web',title:'ComplianceForge',url:'https://www.complianceforge.com/'},
                    {type:'doc',title:'HIPAA Journal',url:'https://www.hipaajournal.com/'}
                ] 
            },
            { 
                id: 14, phase: "Risk", title: "Risk Mgmt", desc: "Risk Assessment, BIA, Third-Party Risk.", topics: ["Risk Assessment", "BIA", "TPRM"], focus: "Mock Assessment.", points: [0, 0, 0, 10, 50], 
                resources: [
                    {type:'doc',title:'NIST SP 800-30',url:'https://csrc.nist.gov/publications/detail/sp/800-30/rev-1/final'},
                    {type:'web',title:'FAIR Institute',url:'https://www.fairinstitute.org/'},
                    {type:'blog',title:'RiskLens Blog',url:'https://www.risklens.com/blog'}
                ] 
            },
            { 
                id: 15, phase: "Compliance", title: "Auditing", desc: "Internal Audit, Control Testing, Policy.", topics: ["Auditing", "Controls", "Policy"], focus: "Draft Policy.", points: [0, 0, 0, 0, 60], 
                resources: [
                    {type:'web',title:'ISACA Resources',url:'https://www.isaca.org/resources'},
                    {type:'doc',title:'SANS Policy Templates',url:'https://www.sans.org/information-security-policy/'},
                    {type:'yt',title:'The Auditor Channel',url:'https://www.youtube.com/channel/UCfA6_z_pP8jKk_e_F4_z5_w'}
                ] 
            }
        ];

        const toolsData = {
            general: ["Wireshark", "Nmap", "Linux CLI", "Python", "VirtualBox"],
            red: ["Burp Suite", "Metasploit", "Hashcat", "Mimikatz"],
            blue: ["Splunk", "Snort", "Velociraptor", "TheHive"],
            grc: ["Excel", "Jira", "Nessus", "ComplianceForge"]
        };

        // UI State
        let currentRole = 'general';
        let charts = {};
        window.completedIds = []; // Global store for completed IDs

        function updateRole(roleKey) {
            currentRole = roleKey;
            document.querySelectorAll('#role-selector button').forEach(btn => btn.className = "px-3 py-1.5 rounded-md text-xs font-medium text-slate-600 hover:text-slate-900 transition-colors");
            document.getElementById(`btn-${roleKey}`).className = "px-3 py-1.5 rounded-md text-xs font-medium bg-white shadow text-slate-900 border border-slate-100";
            const role = roles[roleKey];
            document.getElementById('hero-title').innerText = role.title;
            document.getElementById('hero-desc').innerText = role.desc;
            document.getElementById('stat-salary').innerText = role.salary;
            document.getElementById('stat-time').innerText = role.time;
            renderApp();
        }

        function switchView(viewName) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(`view-${viewName}`).classList.add('active');
            if(viewName === 'dashboard') renderDashboardCharts();
        }

        function renderApp() {
            renderRoadmap();
            renderTools();
            renderCerts();
            calculateStats();
            if(document.getElementById('view-dashboard').classList.contains('active')) renderDashboardCharts();
        }

        function renderRoadmap() {
            const container = document.getElementById('roadmap-items');
            if(!container) return;
            container.innerHTML = '';
            const activeIds = roles[currentRole].pathIds;
            roadmapData.forEach(item => {
                if(activeIds.includes(item.id)) {
                    const isDone = window.completedIds.includes(item.id);
                    const el = document.createElement('div');
                    el.className = "relative pl-8 roadmap-node group";
                    let color = "bg-slate-400";
                    if(item.phase === "Foundations") color = "bg-purple-500";
                    else if(item.phase === "Offensive") color = "bg-red-500";
                    else if(item.phase === "Defensive") color = "bg-blue-500";
                    else if(item.phase === "Governance") color = "bg-emerald-500";
                    else color = "bg-indigo-500";
                    
                    el.innerHTML = `
                        <div class="absolute left-0 top-3 w-6 h-6 rounded-full border-4 border-white shadow-sm z-10 ${isDone ? 'bg-green-500' : color}"></div>
                        <div class="bg-white p-4 rounded-lg border ${isDone ? 'border-green-200 bg-green-50/20' : 'border-slate-100'} shadow-sm hover:shadow-md transition-shadow flex gap-4">
                            <div class="flex-grow cursor-pointer" onclick="showDetails(${item.id})">
                                <span class="text-[10px] font-bold uppercase tracking-wider text-slate-400 block">${item.phase}</span>
                                <h3 class="text-lg font-bold ${isDone ? 'text-green-800' : 'text-slate-800'}">${item.title}</h3>
                                <p class="text-sm text-slate-500 line-clamp-2 mt-1">${item.desc}</p>
                            </div>
                            <div class="flex-shrink-0 pt-2">
                                <input type="checkbox" class="cyber-checkbox" ${isDone ? 'checked' : ''} onchange="toggleCheck(${item.id})">
                            </div>
                        </div>
                    `;
                    container.appendChild(el);
                }
            });
        }

        function showDetails(id) {
            const item = roadmapData.find(i => i.id === id);
            if(!item) return;
            document.getElementById('detail-content').classList.remove('hidden');
            document.getElementById('detail-title').innerText = item.title;
            document.getElementById('detail-phase').innerText = item.phase;
            document.getElementById('detail-desc').innerText = item.desc;
            document.getElementById('detail-focus').innerText = item.focus;
            
            const list = document.getElementById('detail-topics');
            list.innerHTML = '';
            item.topics.forEach(t => {
                const li = document.createElement('li');
                li.innerText = t;
                list.appendChild(li);
            });

            const resContainer = document.getElementById('detail-resources');
            resContainer.innerHTML = '';
            if(item.resources && item.resources.length > 0) {
                item.resources.forEach(res => {
                    const a = document.createElement('a');
                    a.href = res.url;
                    a.target = "_blank";
                    a.className = "flex items-center gap-3 p-2 rounded hover:bg-slate-700 res-link group text-sm text-slate-300";
                    let icon = "üîó";
                    if(res.type === 'yt') { icon = "‚ñ∂"; a.classList.add("text-red-300"); }
                    else if(res.type === 'lab') { icon = "‚ö°"; a.classList.add("text-yellow-300"); }
                    else if(res.type === 'web') { icon = "üåê"; a.classList.add("text-blue-300"); }
                    else if(res.type === 'doc') { icon = "üìÑ"; a.classList.add("text-slate-300"); }
                    else if(res.type === 'blog') { icon = "‚úçÔ∏è"; a.classList.add("text-green-300"); }
                    
                    a.innerHTML = `<span class="flex-shrink-0 w-6 h-6 flex items-center justify-center bg-slate-900 rounded-full font-bold text-xs">${icon}</span><span class="group-hover:text-white text-slate-300">${res.title}</span><span class="ml-auto text-xs text-slate-500">Open ‚Üó</span>`;
                    resContainer.appendChild(a);
                });
            }
        }

        function toggleCheck(id) {
            if(window.completedIds.includes(id)) {
                window.completedIds = window.completedIds.filter(i => i !== id);
            } else {
                window.completedIds.push(id);
            }
            renderApp();
            // Call Firebase Save via Window Bridge
            if(window.saveProgress) window.saveProgress(window.completedIds);
            else {
                // Local fallback so user doesn't think it's broken
                localStorage.setItem('cybernav_temp_progress', JSON.stringify(window.completedIds));
                console.log("Saved locally. Login to sync.");
            }
        }

        function renderTools() {
            const container = document.getElementById('tools-grid');
            container.innerHTML = '';
            let myTools = [...toolsData.general];
            if (currentRole !== 'general') myTools = [...myTools, ...toolsData[currentRole]];
            [...new Set(myTools)].forEach(tool => {
                const d = document.createElement('div');
                d.className = "text-center text-xs font-medium bg-slate-50 border border-slate-200 rounded py-2 text-slate-600";
                d.innerText = tool;
                container.appendChild(d);
            });
        }

        function renderCerts() {
            const container = document.getElementById('cert-ladder');
            container.innerHTML = '';
            roles[currentRole].certs.forEach(tier => {
                const row = document.createElement('div');
                row.className = "flex items-start gap-3 border-b border-slate-100 last:border-0 pb-2";
                let badge = "bg-slate-100 text-slate-600";
                if(tier.tier === "Entry") badge = "bg-green-100 text-green-700";
                if(tier.tier === "Mid") badge = "bg-blue-100 text-blue-700";
                if(tier.tier === "Pro") badge = "bg-purple-100 text-purple-700";
                row.innerHTML = `<span class="text-[10px] font-bold uppercase px-2 py-1 rounded ${badge} w-14 text-center mt-1">${tier.tier}</span><div class="flex flex-wrap gap-2">${tier.names.map(n => `<span class="text-xs border border-slate-200 bg-white px-2 py-1 rounded text-slate-700">${n}</span>`).join('')}</div>`;
                container.appendChild(row);
            });
        }

        function calculateStats() {
            const activeIds = roles[currentRole].pathIds;
            const completed = window.completedIds.filter(id => activeIds.includes(id));
            const pct = Math.round((completed.length / activeIds.length) * 100) || 0;
            document.getElementById('mini-progress-bar').style.width = `${pct}%`;
            document.getElementById('dash-count').innerText = `${completed.length} / ${activeIds.length}`;
            let xp = 0;
            window.completedIds.forEach(id => {
                const node = roadmapData.find(n => n.id === id);
                if(node) xp += node.points.reduce((a,b)=>a+b, 0);
            });
            document.getElementById('dash-xp').innerText = xp;
        }

        function renderDashboardCharts() {
            const ctxGap = document.getElementById('gapRadarChart');
            const ctxBar = document.getElementById('phaseBarChart');
            if(!ctxGap || !ctxBar) return;
            let actualSkills = [0,0,0,0,0];
            window.completedIds.forEach(id => {
                const node = roadmapData.find(n => n.id === id);
                if(node) node.points.forEach((p, i) => actualSkills[i] += p);
            });
            actualSkills = actualSkills.map(s => Math.min(s, 100));
            if(charts.gap) charts.gap.destroy();
            charts.gap = new Chart(ctxGap, {
                type: 'radar',
                data: { labels: ['Net', 'Sys', 'Code', 'Tool', 'Pol'], datasets: [{ label: 'Target', data: roles[currentRole].skills, borderColor: '#cbd5e1', borderDash: [5,5], backgroundColor: 'transparent', pointRadius: 0 }, { label: 'You', data: actualSkills, backgroundColor: 'rgba(59, 130, 246, 0.2)', borderColor: '#3b82f6' }] },
                options: { maintainAspectRatio: false, scales: { r: { suggestedMin: 0, suggestedMax: 100, ticks: { display: false } } } }
            });
            const phases = ["Foundations", "Core Skills", "Offensive", "Defensive", "Governance"];
            const phaseCounts = phases.map(p => {
                return window.completedIds.filter(id => {
                    const node = roadmapData.find(n => n.id === id);
                    return node && node.phase === p;
                }).length;
            });
            if(charts.bar) charts.bar.destroy();
            charts.bar = new Chart(ctxBar, { type: 'bar', data: { labels: phases, datasets: [{ label: 'Modules', data: phaseCounts, backgroundColor: '#6366f1', borderRadius: 4 }] }, options: { maintainAspectRatio: false, scales: { x: { grid: { display: false } } }, plugins: { legend: { display: false } } } });
        }
        
        // Init
        updateRole('general');
    </script>

    <!-- 2. FIREBASE INTEGRATION MODULE -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";

        // Your Exact Config
        const firebaseConfig = {
            apiKey: "AIzaSyAnL6tKhd3GOJs8WimpFP0oRBbb55EknFE",
            authDomain: "cybernav-72778.firebaseapp.com",
            projectId: "cybernav-72778",
            storageBucket: "cybernav-72778.firebasestorage.app",
            messagingSenderId: "574965551290",
            appId: "1:574965551290:web:8801103e786177ba907283",
            measurementId: "G-ZNRSW6JXNW"
        };

        try {
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            const provider = new GoogleAuthProvider();

            const btnLogin = document.getElementById('btn-login');
            const btnLogout = document.getElementById('btn-logout');
            const userDisplay = document.getElementById('user-display');

            // Global Bridge Functions
            window.triggerLogin = async () => {
                try { await signInWithPopup(auth, provider); } 
                catch(error) { 
                    console.error("Login Failed", error); 
                    alert("Login Failed: " + error.message);
                }
            };

            window.triggerLogout = async () => {
                try { await signOut(auth); } catch(error) { console.error("Logout Failed", error); }
            };

            window.saveProgress = async (ids) => {
                if(auth.currentUser) {
                    try {
                        await setDoc(doc(db, "users", auth.currentUser.uid), { completedIds: ids }, { merge: true });
                    } catch(e) { console.error("Save Error", e); }
                }
            };

            // Listener
            btnLogin.onclick = window.triggerLogin;
            btnLogout.onclick = window.triggerLogout;

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    btnLogin.classList.add('hidden');
                    btnLogout.classList.remove('hidden');
                    userDisplay.innerText = user.displayName;
                    userDisplay.classList.remove('hidden');
                    userDisplay.classList.add('bg-blue-100', 'text-blue-800');

                    // Load Data
                    const userDoc = doc(db, "users", user.uid);
                    onSnapshot(userDoc, (docSnap) => {
                        if (docSnap.exists()) {
                            window.completedIds = docSnap.data().completedIds || [];
                            if(typeof renderApp === 'function') renderApp();
                        }
                    });
                } else {
                    btnLogin.classList.remove('hidden');
                    btnLogout.classList.add('hidden');
                    userDisplay.innerText = "Guest Mode";
                    userDisplay.classList.remove('bg-blue-100', 'text-blue-800');
                    // Check local storage for temp progress
                    const temp = localStorage.getItem('cybernav_temp_progress');
                    window.completedIds = temp ? JSON.parse(temp) : [];
                    if(typeof renderApp === 'function') renderApp();
                }
            });
        } catch(e) {
            console.error("Firebase Init Failed:", e);
            alert("Database connection failed. App running in offline mode.");
        }
    </script>


</body>
</html>
